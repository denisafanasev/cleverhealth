{% extends 'base.html' %}

{% block main_block %}
{#    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">#}
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/rowgroup/1.1.4/css/rowGroup.dataTables.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="{{ url_for('static' , filename="js/datatables.js")}}"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/rowgroup/1.1.4/js/dataTables.rowGroup.min.js"></script>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // DataTables with Buttons
            $("#datatables-homeworks").DataTable({
                responsive: false,
                lengthChange: !1,
                {#scrollY: "500px",#}
                {#scrollCollapse: true,#}
                scrollX: true,
                paging: true,
                fixedHeader: false,
                fixedColumns: false,
                pageLength: 20,
                ordering: true,
                orderMulti: true,
                orderFixed: [[0, 'asc'], [3, "asc"], [4, "asc"]],
                rowGroup: {
                    dataSrc: [5, 6]
                },
                columnDefs: [
                    {
                        "targets": [ 0, 3, 4, 5, 6 ],
                        "visible": false
                    },
                    {
                      "targets": 5,
                      "sType": "date-uk"
                    }
                ]
            });

            jQuery.extend( jQuery.fn.dataTableExt.oSort, {
                "date-uk-pre": function ( a ) {
                var ukDatea = a.split('/');
                return (ukDatea[2] + ukDatea[1] + ukDatea[0]) * 1;
                },

                "date-uk-asc": function ( a, b ) {
                return ((a < b) ? -1 : ((a > b) ? 1 : 0));
                },

                "date-uk-desc": function ( a, b ) {
                return ((a < b) ? 1 : ((a > b) ? -1 : 0));
                }
            } );

            {#datatableshomeworks.buttons().container().appendTo("#datatables-buttons_wrapper .col-md-6:eq(0)");#}
        });
    </script>

{#    <style>#}
{#    table.dataTable thead .sorting,#}
{#        table.dataTable thead .sorting_asc,#}
{#        table.dataTable thead .sorting_desc {#}
{#            background : none;#}
{#        }#}
{#    </style>#}
    <style>
    .dataTables_scroll{
        overflow: auto;
    }
    </style>

    <div class="container-fluid p-0">

        <div class="mb-3">
            <h1 class="h3 d-inline align-middle">Проверка домашних заданий</h1>
        </div>

        <form id="homeworks" name="homeworks" method="post" enctype="multipart/form-data">
            <div class="row d-flex align-items-stretch bd-highlight">
                <div class="p-2 bd-highlight">
                    <div class="card d-flex align-self-baseline">
                        <div class="card-header">
                            <div class="row">
                                <label for="education_stream">Выберите поток:</label>
                                <div class="col-sm-1">
                                    <select class="form-select" onchange="this.form.submit();" name="education_stream" id="education_stream">
                                        {% for education_stream in range(1, _amount_education_streams + 1) %}
                                            <option {% if education_stream == _id_education_stream %}selected{% endif %} value="{{ education_stream }}">{{ education_stream }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-sm">
                                    <a class="btn btn-primary pb-1" href="/education_home_tasks?data_option=chat_without_homework">Чаты без домашних работ</a>
                                    <a class="btn btn-primary pb-1" href="/education_home_tasks?data_option=homework_verified">Проверенные домашние работы</a>
                                    <a class="btn btn-primary pb-1" href="/education_home_tasks">Не проверенные домашние работы</a>
                                </div>
                            </div>
                        <h3>Поток: {{ _id_education_stream }}</h3>
                            <table id="datatables-homeworks" class="table dataTable no-footer nowrap"
                                   aria-describedby="datatables-buttons_info" style="width: 100%">
                                <thead>
                                    <tr role="row">
                                        <th rowspan="1" colspan="1" style="width: 0">#</th>
                                        <th class="sorting" style="width:20%" tabindex="0" aria-controls="datatables-homeworks"
                                            aria-label="Position: activate to sort column ascending" rowspan="1" colspan="1">Login</th>
                                        <th class="sorting" style="width:20%" tabindex="0" aria-controls="datatables-homeworks"
                                            aria-label="Position: activate to sort column ascending" rowspan="1" colspan="1">Имя</th>
                                        <th rowspan="1" colspan="1" style="width: 5%">ID Модуля</th>
                                        <th rowspan="1" colspan="1" style="width: 5%">ID Урока</th>
                                        <th rowspan="1" colspan="1" style="width: 5%">Модуль</th>
                                        <th rowspan="1" colspan="1" style="width: 5%">Урок</th>
                                        <th class="sorting" style="width:20%" tabindex="0" aria-controls="datatables-homeworks"
                                            aria-label="Position: activate to sort column ascending" rowspan="1" colspan="1">Дата сдачи</th>
                                        <th class="sorting" style="width:5%" tabindex="0" aria-controls="datatables-homeworks"
                                            aria-label="Position: activate to sort column ascending" rowspan="1" colspan="1">Статус</th>
                                        <th class="sorting" style="width:5%" tabindex="0" aria-controls="datatables-homeworks"
                                            aria-label="Position: activate to sort column ascending" rowspan="1" colspan="1">Ответ</th>
                                        <th class="sorting" style="width:20%; text-align: center" tabindex="0" aria-controls="datatables-homeworks"
                                            aria-label="Position: activate to sort column ascending" rowspan="1" colspan="1">Домашняя работа</th>
                                        <th class="sorting" style="width:5%" tabindex="0" aria-controls="datatables-homeworks"
                                            aria-label="Position: activate to sort column ascending" rowspan="1" colspan="1"></th>
                                    </tr>
                                </thead>
                                <tbody class="table-bordered">
                                {% for item in _data %}
                                    {% if item['homework_list'] is not none %}
                                        {% for homework in item['homework_list'] %}
                                            <tr>
        {#                                        <td>Обучающий поток(курс потока):{{ item['education_stream']['name'] }}({{ item['course']['name'] }})</td>#}
                                                <td>{{ item['lesson']['id'] }}</td>
                                                <td>{{ item["user"]['login'] }}</td>
                                                <td>{{ item["user"]['name'] }}</td>
                                                <td>{{ item['module']['id'] }}</td>
                                                <td>{{ item['lesson']['id'] }}</td>
                                                <td>{{ item['module']['name'] }}</td>
                                                <td>Урок: {{ item['lesson']['name'] }}</td>
                                                <td>{{ homework['date_delivery'] }}</td>
                                                <td>
                                                    <div class='badge {% if homework['status'] == "Не проверено" %} bg-info {% else %} bg-success {% endif %} bg-gradient text-light'>
                                                        {% if homework['status'] == "Не проверено" %}{{ homework['status'] }}{% else %}Проверено{% endif %}
                                                    </div>
                                                </td>
                                                <td><div class='badge {% if homework['status'] == "Принято" %} bg-success {% elif homework['status'] == "Не принято" %} bg-danger {% endif %} bg-gradient text-light'>{{ homework['status'] }}</div></td>
                                                <td style="text-align: center">
                                                    <a href="/education_home_task_card?id_homework={{ homework['id'] }}" >
                                                        Перейти
                                                    </a>
                                                </td>
                                                {% if item['homework_chat'] %}
                                                    {% if item['homework_chat']['unread_message_amount'] != 0 %}
                                                        {% if item['homework_chat']['unread_message_amount']%}
                                                            <td style="display: revert">
                                                                <div class="badge bg-danger float-end" style="text-align: left">
                                                                    {{ item['homework_chat']['unread_message_amount'] }}
                                                                </div>
                                                            </td>
                                                        {% else %}
                                                            <td></td>
                                                        {% endif %}
                                                    {% else %}
                                                    <td></td>
                                                {% endif %}
                                                {% else %}
                                                    <td></td>
                                                {% endif %}
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
    {#                                        <td>Обучающий поток(курс потока):{{ item['education_stream']['name'] }}({{ item['course']['name'] }})</td>#}
                                            <td>{{ item['lesson']['id'] }}</td>
                                            <td>{{ item["user"]['login'] }}</td>
                                            <td>{{ item["user"]['name'] }}</td>
                                            <td>{{ item['module']['id'] }}</td>
                                            <td>{{ item['lesson']['id'] }}</td>
                                            <td>{{ item['module']['name'] }}</td>
                                            <td>Урок: {{ item['lesson']['name'] }}</td>
                                            <td></td>
                                            <td>
                                                <div class='badge bg-warning bg-gradient text-light'>
                                                    Не сдано
                                                </div>
                                            </td>
                                            <td></td>
                                            <td style="text-align: center">
                                                <a href="/education_home_task_card?id_chat={{ item['homework_chat']['id'] }}" >
                                                    Перейти
                                                </a>
                                            </td>
                                            {% if item['homework_chat'] %}
                                                {% if item['homework_chat']['unread_message_amount'] != 0 %}
                                                    <td style="display: revert">
                                                        <div class="badge bg-danger float-end" style="text-align: left">
                                                            {{ item['homework_chat']['unread_message_amount'] }}
                                                        </div>
                                                    </td>
                                                    {% else %}
                                                    <td></td>
                                                {% endif %}
                                            {% else %}
                                                <td></td>
                                            {% endif %}
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
{% endblock %}